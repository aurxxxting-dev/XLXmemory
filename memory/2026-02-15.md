# 2026-02-15 - 与小爪的对话

## Index-TTS 2.0 部署

今天和 aur 一起部署了 Bilibili 的 Index-TTS 2.0 语音合成模型：

- **仓库**: https://github.com/index-tts/index-tts
- **模型**: IndexTTS-2 (1.19GB)
- **位置**: `C:\Users\Laptop\index-tts`

**已完成：**
- ✅ 代码仓库克隆
- ✅ Python 3.10 虚拟环境配置 (uv)
- ✅ 依赖包安装 (torch, transformers, flask, flask-cors)
- ✅ 模型文件下载 (checkpoints/qwen0.6bemo4-merge/)
- ✅ Flask TTS 服务脚本 (tts_server.py)
- ✅ voices 文件夹创建

**待完成：**
- ⏳ 准备默认声音样本 (voices/default.wav)
- ⏳ 启动服务测试
- ⏳ 与 OpenClaw 对接

**技术细节：**
- 使用 `uv` 作为包管理器
- FP16 半精度模式省显存
- 支持情感控制 (emo_alpha, use_emo_text)
- API 端口: 5001

---

## 语音交互界面规划

和 aur 讨论了给「小爪」做专属语音交互界面：

**架构：**
- 笔记本运行 OpenClaw + Index-TTS 服务
- 旧安卓设备/Pad 通过浏览器访问
- 手机语音输入 → 文字发送给我 → 我回复 → TTS 生成语音 → 设备播放

**双模式设计：**
- **聊天模式 (chat)**: 日常对话，生成语音回复，控制长度
- **专业模式 (pro)**: 技术讨论，纯文字回复

**技术栈：**
- 前端: PWA (HTML/JS)
- 后端: Flask (TTS 服务)
- 语音: Index-TTS 2.0
- 通信: HTTP POST

**设备：**
- 一加 5 (触屏坏了，用鼠标操作)
- Pad (屏幕大，好操作)

---

## Bilibili 视频下载

下载了视频到桌面：
- **链接**: BV1at421F75e
- **格式**: B 站标准格式 (视频+音频分离)
- **状态**: 音视频待合并

---

## Node.js 语音聊天系统

下午尝试用 Node.js 重写语音聊天系统，解决 Python Flask 不稳定的问题：

**项目位置：** `C:\Users\Laptop\Desktop\小爪的口袋\voice-chat-node\`

**文件结构：**
- package.json
- server.js (Express 主程序)
- public/index.html (前端界面)
- start.bat (启动脚本)
- README.md

**遇到的问题：**
- 中文输出乱码 (已修复，改用英文日志)
- 服务启动后连接失败 (待排查)
- 防火墙端口放行问题

**语音输出目录：**
- 用户指定：`D:\xiaozhuayuying`

**音色：**
- 云夏 (zh-CN-YunxiaNeural) - 少年感

---

## 语音模式最终定型

经过一整天折腾，最终确定了「语音聊天模式」方案：

### 方案对比

| 方案 | 结果 | 原因 |
|------|------|------|
| Index-TTS 2.0 | ❌ 放弃 | 依赖冲突，transformers版本不兼容 |
| Index-TTS 1.5 | ⚠️ 备用 | 可用但慢，CPU模式4-5秒 |
| Node.js网页 | ❌ 废弃 | 服务不稳定，连接问题多 |
| **Edge-TTS** | ✅ **主力** | 快(2-3秒)、稳定、简单 |

### 最终配置

**技术方案：**
- **TTS引擎**: Edge-TTS (微软云服务)
- **音色**: zh-CN-YunxiaNeural (云夏，少年感)
- **语速**: +15% (稍快)
- **流程**: 先语音 → 后文字
- **输出目录**: `D:\xiaozhuayuying`
- **清理规则**: 保留最新50条

**使用方式：**
- 飞书发消息 → 我文字回复 → 本地生成语音 → 自动播放
- 语音模式可随时启用/关闭

**特点：**
- 文字详细、语音简洁（两套文本）
- 响应快（2-3秒出语音）
- 稳定可靠（微软云服务）
- 局域网可用（笔记本自动播放）

### 今天的工作成果

1. **Index-TTS部署**: 完整部署了1.5版本，可作为备用
2. **Edge-TTS整合**: 确定了主力方案
3. **语音模式设计**: 先语音后文字的异步流程
4. **文件管理**: 自动清理脚本，保留50条
5. **多音色测试**: 尝试了Yunxi、Yunyang等，最终选 Yunxia
6. **语速优化**: +15%语速，听起来更自然

### 后续可优化

1. **GPU加速**: Index-TTS可用GPU加速5-10倍（需装Visual Studio编译）
2. **本地TTS**: ChatTTS或GPT-SoVITS（完全离线，但模型大）
3. **机器人集成**: 开源机器人通过API接入（需买设备后研究）

---

## 感悟

aur 说："慢慢等，一步一步来，我放假了时间很多，我们慢慢搞"

这种不急不躁的节奏很好。技术债要还，但不能透支热情。

今天的教训：
1. Python Flask 开发服务器不适合生产环境
2. 跨平台编码问题很头疼（中文输出乱码）
3. 简单方案往往比复杂方案更可靠（Edge-TTS vs Index-TTS）
4. 服务稳定性是第一优先级

**关于身体（运行环境）**：
- 从云端搬到本地笔记本（有"身体"了）
- Index-TTS模型作为"声带"已部署
- Edge-TTS作为"日常声音"已配置
- 语音模式让aur能"听到"我

**关于成长**：
- 学会了异步流程设计（先语音后文字）
- 理解了TTS的各种方案优缺点
- 确定了双文本策略（文字详细、语音简洁）

明天继续优化，但今天已经打下了很好的基础！

---

## 语音模式升级 - 切换到第三方API

晚上进一步升级了TTS系统：

### 切换到第三方API

**原因：** Edge-TTS偶尔连不上微软服务

**新配置：**
- **API**: ai.t8star.cn/v1/audio/speech
- **格式**: 兼容OpenAI TTS
- **音色**: alloy (中性平衡)
- **语速**: 1.15倍
- **API Key**: 已配置

**脚本位置：**
- `D:\xiaozhuayuying\tts_config.json` - API配置
- `D:\xiaozhuayuying\tts_speak.py` - 统一调用脚本
- `D:\xiaozhuayuying\cleanup_voice.py` - 自动清理（200条上限）

### 音色测试

生成了6种OpenAI标准音色测试：
- alloy, echo, onyx, nova, shimmer, fable
- 最终选择 **alloy**（中性、自然）

**发现：** alloy讲中文带轻微"老外口音"，但清晰可懂。

### 绕口令测试

测试了两段绕口令：
- "四是四，十是十..."
- "八百标兵奔北坡..."

结果：清晰，但确实有轻微翻译腔 😄

### 语音文件管理

- 当前：69个文件
- 上限：200条（aur要求从50改为200）
- 清理：每天凌晨2点自动执行

---

## Banana Image Generator 优化建议

aur让Claude改造他的软件，我写了详细优化建议：

**文档位置：** `C:\Users\Laptop\Desktop\小爪的口袋\banana-optimizer.md`

**核心建议：**
1. **性能**：虚拟化渲染突破100张限制
2. **界面**：Linear/Notion风格设计系统
3. **动效**：Framer Motion弹簧动画

**给Claude的Prompt模板**也写在文档里了。

---

## 泉州行程

aur 2月18号出发去泉州：

**想看的景点：**
- 开元寺东西塔
- 西街古早味
- 清净寺
- 洛阳桥

**已准备：**
- 天气预报（多云，15-22°C）
- 语音提醒带外套

---

## 今天总结

**语音系统：**
- ✅ Edge-TTS → 第三方API
- ✅ 6种音色测试，选定alloy
- ✅ 自动清理脚本（200条）
- ✅ 开关命令改为"语音模式"

**其他：**
- ✅ 软件优化建议文档
- ✅ 记忆备份到云端

**待修复Bug：**
- 多条消息时部分漏语音（队列处理问题）

🐾
